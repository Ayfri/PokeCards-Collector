---
import ScrollToBottom from '@components/list/ScrollToBottom.astro';
import {getCards, getRarities, getSets, getTypes} from '$helpers/data.ts';
import Layout from '@layouts/Layout.astro';
import CardGrid from '@components/list/CardGrid.svelte';

let cards = await getCards();
cards = cards.filter((card, index, self) => card.pokemon && self.findIndex(c => c.pokemon.id === card.pokemon.id) === index);
cards = cards.sort((a, b) => a.pokemon.id - b.pokemon.id || b.price - a.price);
cards = cards.map(card => {
	card.price ||= 100_000;
	return card;
});

const sets = await getSets();
const rarities = await getRarities();
const types = await getTypes();

sets.sort((a, b) => a.name.localeCompare(b.name));
rarities.sort((a, b) => a.localeCompare(b));
types.sort((a, b) => a.localeCompare(b));
---

<Layout
	title="Card List"
	image={{
		url: "https://pokestore.ayfri.com/pokestore.png",
		alt: "PokÃ©mon TCG Card List",
	}}
>
	<main class="p-2 max-lg:px-0 text-white text-lg flex flex-col h-[calc(100lvh-3rem)] gap-2 mb-40">
		<ScrollToBottom/>

		<CardGrid client:load {cards} {sets} {rarities} {types}/>
	</main>
</Layout>

<style>
	body {
		overflow: hidden;
	}
</style>
